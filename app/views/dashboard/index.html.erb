<div class="container">
  <!-- Welcome Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-1">Welcome back, <%= @shop.shopify_domain %></h1>
      <p class="text-muted">Here's what's happening with your store</p>
    </div>
  </div>

  <!-- Quick Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">Total Products</h6>
              <h3 class="mb-0"><%= @shop.kuralis_products.count %></h3>
            </div>
            <div class="text-primary">
              <i class="bi bi-box fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">Shopify Products</h6>
              <h3 class="mb-0"><%= @shop.shopify_products.count %></h3>
            </div>
            <div class="text-success">
              <i class="bi bi-shop fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">eBay Listings</h6>
              <h3 class="mb-0"><%= @shop.ebay_listings_count %></h3>
            </div>
            <div class="text-warning">
              <i class="bi bi-tags fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="text-muted mb-2">Recent Orders</h6>
              <h3 class="mb-0"><%= @shop.recent_orders_count %></h3>
            </div>
            <div class="text-info">
              <i class="bi bi-cart fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <!-- Recent Activity -->
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Recent Activity</h5>
          <div class="list-group list-group-flush">
            <% @shop.recent_orders.each do |order| %>
              <div class="list-group-item px-0">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="mb-0">New Order #<%= order.platform_order_id %></h6>
                    <small class="text-muted"><%= order.customer_name %> â€¢ <%= number_to_currency(order.total_price) %></small>
                  </div>
                  <span class="badge bg-success"><%= order.platform.titleize %></span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Distribution Chart -->
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Product Distribution</h5>
          <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
            <div style="width: 200px; height: 200px;">
              <canvas id="productDistributionChart"></canvas>
            </div>
          </div>
          <div class="d-flex justify-content-center gap-3 mt-3">
            <div class="d-flex align-items-center">
              <div class="badge bg-success me-2">&nbsp;</div>
              <small>Shopify</small>
            </div>
            <div class="d-flex align-items-center">
              <div class="badge bg-warning me-2">&nbsp;</div>
              <small>eBay</small>
            </div>
            <div class="d-flex align-items-center">
              <div class="badge bg-secondary me-2">&nbsp;</div>
              <small>Unlinked</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Quick Actions</h5>
          <div class="d-flex gap-2">
            <%= link_to shopify_products_path, class: "btn btn-outline-primary" do %>
              <i class="bi bi-shop me-2"></i>View Shopify Products
            <% end %>
            <%= link_to ebay_listings_path, class: "btn btn-outline-warning" do %>
              <i class="bi bi-tags me-2"></i>View eBay Listings
            <% end %>
            <%= link_to kuralis_products_path, class: "btn btn-outline-success" do %>
              <i class="bi bi-box me-2"></i>View All Products
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('productDistributionChart').getContext('2d');
  const data = <%= raw @shop.product_distribution_data.to_json %>;
  
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Shopify', 'eBay', 'Unlinked'],
      datasets: [{
        data: [data.shopify, data.ebay, data.unlinked],
        backgroundColor: [
          '#198754',  // Success green
          '#ffc107',  // Warning yellow
          '#6c757d'   // Secondary gray
        ],
        borderWidth: 0,
        cutout: '70%'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = Math.round((context.raw / total) * 100);
              return `${context.label}: ${context.raw} (${percentage}%)`;
            }
          }
        }
      }
    }
  });
});
</script>
