<div class="col-md-6 mb-4" id="analysis_<%= analysis.id %>">
  <div class="analysis-item position-relative">
    <% if analysis.image_attachment.attached? %>
      <%= image_tag analysis.image_attachment.variant(resize_to_limit: [300, 200]), 
                    class: "analysis-image",
                    loading: "lazy",
                    style: "object-fit: cover; width: 100%; height: 150px;" %>
    <% else %>
      <div class="analysis-image bg-light d-flex align-items-center justify-content-center">
        <i class="fas fa-image fa-3x text-muted"></i>
      </div>
    <% end %>
    <div class="analysis-status status-<%= analysis.status %>">
      <%= analysis.status_message %>
    </div>
    <div class="p-3">
      <h6 class="mb-2 font-weight-bold">
        <% if analysis.completed? %>
          <%= analysis.suggested_title.presence || "Untitled Product" %>
        <% else %>
          <span class="placeholder-glow">
            <span class="placeholder col-7"></span>
          </span>
        <% end %>
      </h6>
      <div class="small text-muted mb-3" style="min-height: 60px;">
        <% if analysis.completed? %>
          <%= truncate(analysis.suggested_description.presence || "No description available", length: 100) %>
        <% elsif analysis.processing? %>
          <div class="d-flex align-items-center">
            <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <span>AI is analyzing this image...</span>
          </div>
        <% elsif analysis.failed? %>
          <div class="text-danger">
            <i class="fas fa-exclamation-triangle me-1"></i>
            Analysis failed. Please try uploading again.
          </div>
        <% else %>
          <span class="placeholder-glow">
            <span class="placeholder col-10"></span>
            <span class="placeholder col-8"></span>
            <span class="placeholder col-9"></span>
          </span>
        <% end %>
      </div>
      
      <% if analysis.completed? %>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <% if analysis.suggested_brand.present? %>
              <span class="badge bg-info me-1"><%= analysis.suggested_brand %></span>
            <% end %>
            <span class="badge bg-secondary">Price: TBD</span>
            <% if analysis.suggested_category_confidence > 0 %>
              <span class="badge bg-<%= analysis.category_confidence_level == 'high' ? 'success' : analysis.category_confidence_level == 'medium' ? 'warning' : 'danger' %> me-1">
                Category: <%= (analysis.suggested_category_confidence * 100).round %>%
              </span>
            <% end %>
            <% if analysis.suggested_item_specifics_confidence > 0 %>
              <span class="badge bg-<%= analysis.item_specifics_confidence_level == 'high' ? 'success' : analysis.item_specifics_confidence_level == 'medium' ? 'warning' : 'danger' %> me-1">
                Specifics: <%= (analysis.suggested_item_specifics_confidence * 100).round %>%
              </span>
            <% end %>
            <% if analysis.requires_category_review? %>
              <span class="badge bg-warning text-dark me-1">
                <i class="fas fa-exclamation-triangle me-1"></i>Category Review
              </span>
            <% end %>
            <% if analysis.requires_specifics_review? %>
              <span class="badge bg-warning text-dark me-1">
                <i class="fas fa-exclamation-triangle me-1"></i>Specifics Review
              </span>
            <% end %>
            <% if analysis.missing_required_specifics.any? %>
              <span class="badge bg-danger me-1" title="Missing: <%= analysis.missing_required_specifics.join(', ') %>">
                <i class="fas fa-exclamation-circle me-1"></i><%= analysis.missing_required_specifics.size %> Missing
              </span>
            <% end %>
          </div>
          <div>
            <% if analysis.has_draft_product? %>
              <%= link_to edit_kuralis_product_path(analysis.kuralis_product, finalize: true), 
                  class: "btn btn-sm btn-success" do %>
                <i class="fas fa-edit me-1"></i> Edit Draft
              <% end %>
            <% else %>
              <span class="badge bg-secondary">Creating Draft...</span>
            <% end %>
          </div>
        </div>
      <% elsif analysis.failed? %>
        <div class="d-flex justify-content-end">
          <%= button_to kuralis_ai_product_analysis_path(analysis), 
              method: :delete,
              class: "btn btn-sm btn-outline-danger",
              data: { confirm: "Remove this failed analysis?" } do %>
            <i class="fas fa-trash me-1"></i> Remove
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div> 